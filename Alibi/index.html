<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>女巫的毒药 - 超级侦探</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #e6e6e6;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            position: relative;
            overflow-x: hidden;
        }
        
        body::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><path d="M0,0 L100,100 M100,0 L0,100" stroke="rgba(90,0,180,0.1)" stroke-width="1"/></svg>');
            opacity: 0.3;
            z-index: -1;
        }
        
        .header {
            text-align: center;
            margin: 20px 0 30px;
            width: 100%;
            max-width: 800px;
        }
        
        h1 {
            font-size: 2.8rem;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #ff6b6b, #ff8e53, #ff6b6b);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            text-shadow: 0 0 15px rgba(255, 107, 107, 0.4);
            letter-spacing: 2px;
        }
        
        .subtitle {
            font-size: 1.2rem;
            color: #a0a0c0;
            margin-bottom: 15px;
        }
        
        .game-container {
            display: flex;
            flex-direction: column;
            width: 100%;
            max-width: 1200px;
            gap: 25px;
        }
        
        /* 主内容区域 */
        .main-content {
            flex: 1;
            background: rgba(30, 30, 50, 0.8);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(100, 100, 200, 0.3);
        }
        
        /* 难度选择界面 */
        .difficulty-screen {
            text-align: center;
            padding: 20px;
        }
        
        .difficulty-title {
            font-size: 1.8rem;
            margin-bottom: 30px;
            color: #e6e6ff;
        }
        
        .difficulty-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }
        
        .difficulty-card {
            background: rgba(50, 50, 80, 0.7);
            border-radius: 10px;
            padding: 25px 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }
        
        .difficulty-card:hover {
            transform: translateY(-5px);
            background: rgba(70, 70, 120, 0.8);
            border-color: #6a5acd;
            box-shadow: 0 5px 15px rgba(106, 90, 205, 0.4);
        }
        
        .difficulty-card h3 {
            font-size: 1.5rem;
            margin-bottom: 15px;
            color: #b19cd9;
        }
        
        .difficulty-card p {
            font-size: 0.9rem;
            color: #b0b0d0;
            margin-bottom: 10px;
        }
        
        /* 故事背景 */
        .story-section {
            background: rgba(20, 20, 35, 0.7);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 25px;
            border-left: 4px solid #ff6b6b;
        }
        
        .story-title {
            font-size: 1.4rem;
            margin-bottom: 15px;
            color: #ff8e53;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .story-content {
            line-height: 1.6;
            color: #d0d0e0;
        }
        
        /* 游戏信息与道具箱 */
        .info-tools-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
            margin-bottom: 25px;
        }
        
        @media (max-width: 768px) {
            .info-tools-container {
                grid-template-columns: 1fr;
            }
        }
        
        .game-info {
            background: rgba(25, 25, 45, 0.9);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(100, 100, 200, 0.3);
        }
        
        .tools-section {
            background: rgba(25, 25, 45, 0.9);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(100, 100, 200, 0.3);
        }
        
        .section-title {
            font-size: 1.4rem;
            margin-bottom: 20px;
            color: #9b59b6;
            text-align: center;
            padding-bottom: 10px;
            border-bottom: 2px solid rgba(155, 89, 182, 0.4);
        }
        
        .info-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid rgba(100, 100, 180, 0.3);
        }
        
        .info-item:last-child {
            border-bottom: none;
        }
        
        .info-label {
            color: #b0b0d0;
        }
        
        .info-value {
            font-weight: bold;
            color: #f1c40f;
        }
        
        .actions-remaining {
            color: #2ecc71;
        }
        
        .days-remaining.danger {
            color: #e74c3c;
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.6; }
            100% { opacity: 1; }
        }
        
        /* 道具系统 - 重点优化部分 */
        .tools-container {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
        }
        
        .tool-card {
            background: linear-gradient(145deg, rgba(70, 100, 130, 0.8), rgba(40, 60, 90, 0.8));
            border-radius: 10px;
            padding: 15px 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid rgba(90, 120, 180, 0.5);
            position: relative;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }
        
        .tool-card:hover:not(.used):not(.frozen) {
            transform: translateY(-5px);
            background: linear-gradient(145deg, rgba(80, 120, 160, 0.9), rgba(50, 80, 120, 0.9));
            border-color: #6a5acd;
            box-shadow: 0 6px 15px rgba(106, 90, 205, 0.5);
        }
        
        .tool-icon {
            font-size: 2.2rem;
            margin-bottom: 12px;
            color: #b19cd9;
            transition: all 0.3s ease;
        }
        
        .tool-card:hover:not(.used):not(.frozen) .tool-icon {
            transform: scale(1.1);
            color: #d0c0f0;
            text-shadow: 0 0 10px rgba(177, 156, 217, 0.7);
        }
        
        .tool-name {
            font-size: 1rem;
            color: #e6e6ff;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        
        .tool-card:hover:not(.used):not(.frozen) .tool-name {
            color: #ffffff;
            text-shadow: 0 0 5px rgba(255, 255, 255, 0.5);
        }
        
        /* 道具状态标记 */
        .tool-card.used::after {
            content: "已使用";
            position: absolute;
            top: 8px;
            right: 8px;
            background: #e74c3c;
            color: white;
            font-size: 0.8rem;
            padding: 4px 8px;
            border-radius: 15px;
            font-weight: bold;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
            z-index: 10;
        }
        
        .tool-card.frozen::after {
            content: "已冻结";
            position: absolute;
            top: 8px;
            right: 8px;
            background: #3498db;
            color: white;
            font-size: 0.8rem;
            padding: 4px 8px;
            border-radius: 15px;
            font-weight: bold;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
            z-index: 10;
        }
        
        /* 已使用道具样式 */
        .tool-card.used {
            background: linear-gradient(145deg, rgba(90, 60, 70, 0.7), rgba(60, 40, 45, 0.7));
            border-color: rgba(180, 80, 80, 0.5);
            opacity: 0.8;
            cursor: not-allowed;
        }
        
        .tool-card.used .tool-icon {
            color: #b08080;
        }
        
        .tool-card.used .tool-name {
            color: #c0a0a0;
        }
        
        /* 已冻结道具样式 */
        .tool-card.frozen {
            background: linear-gradient(145deg, rgba(60, 80, 120, 0.7), rgba(40, 50, 90, 0.7));
            border-color: rgba(80, 140, 200, 0.5);
            cursor: not-allowed;
        }
        
        .tool-card.frozen .tool-icon {
            color: #80b0d0;
        }
        
        .tool-card.frozen .tool-name {
            color: #a0c0e0;
        }
        
        /* 推理日志 */
        .log-section {
            background: rgba(15, 15, 30, 0.8);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 25px;
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid rgba(100, 100, 180, 0.4);
        }
        
        .log-title {
            font-size: 1.4rem;
            margin-bottom: 15px;
            color: #3498db;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .log-content {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .log-entry {
            padding: 12px 15px;
            background: rgba(40, 40, 70, 0.5);
            border-radius: 8px;
            border-left: 3px solid #3498db;
            font-size: 0.95rem;
        }
        
        .log-entry.suspicious {
            border-left-color: #e74c3c;
        }
        
        .log-entry.eliminated {
            border-left-color: #2ecc71;
        }
        
        .log-entry.tool-used {
            border-left-color: #9b59b6;
        }
        
        .log-time {
            font-size: 0.8rem;
            color: #95a5a6;
            margin-bottom: 5px;
        }
        
        /* 嫌疑人网格 */
        .suspects-section {
            margin-bottom: 25px;
        }
        
        .suspects-title {
            font-size: 1.4rem;
            margin: 0 0 15px 0;
            color: #b19cd9;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .grid-container {
            display: grid;
            gap: 12px;
            margin: 0 auto;
            justify-content: center;
        }
        
        .grid-2x2 {
            grid-template-columns: repeat(2, 1fr);
            max-width: 300px;
        }
        
        .grid-3x3 {
            grid-template-columns: repeat(3, 1fr);
            max-width: 450px;
        }
        
        .grid-4x4 {
            grid-template-columns: repeat(4, 1fr);
            max-width: 600px;
        }
        
        .grid-5x5 {
            grid-template-columns: repeat(5, 1fr);
            max-width: 750px;
        }
        
        .suspect-cell {
            aspect-ratio: 1;
            background: rgba(60, 60, 100, 0.6);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
            border: 2px solid transparent;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        
        .suspect-cell:hover {
            background: rgba(80, 80, 140, 0.8);
            border-color: #9b59b6;
            transform: scale(1.05);
            box-shadow: 0 6px 12px rgba(155, 89, 182, 0.4);
        }
        
        .suspect-cell.eliminated::before {
            content: "✘";
            position: absolute;
            font-size: 4rem;
            color: rgba(255, 50, 50, 0.9);
            z-index: 10;
            text-shadow: 0 0 10px rgba(255, 0, 0, 0.7);
        }
        
        /* 按钮区域 */
        .buttons-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 10px;
        }
        
        @media (max-width: 480px) {
            .buttons-container {
                grid-template-columns: 1fr;
            }
        }
        
        .btn {
            background: linear-gradient(45deg, #9b59b6, #6a5acd);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 50px;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            box-shadow: 0 4px 15px rgba(106, 90, 205, 0.4);
        }
        
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(106, 90, 205, 0.6);
        }
        
        .btn:active {
            transform: translateY(1px);
        }
        
        .btn-restart {
            background: linear-gradient(45deg, #e74c3c, #c0392b);
        }
        
        /* 游戏结束弹窗 */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }
        
        .modal.active {
            opacity: 1;
            pointer-events: all;
        }
        
        .modal-content {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            border-radius: 15px;
            padding: 40px;
            max-width: 90%;
            width: 500px;
            text-align: center;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.7);
            border: 2px solid #6a5acd;
            position: relative;
        }
        
        .modal-title {
            font-size: 2.2rem;
            margin-bottom: 20px;
            color: #ff6b6b;
        }
        
        .modal-subtitle {
            font-size: 1.4rem;
            margin-bottom: 25px;
            color: #f1c40f;
        }
        
        .modal-story {
            background: rgba(30, 30, 50, 0.7);
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            text-align: left;
            border-left: 4px solid #3498db;
        }
        
        .modal-killer {
            font-size: 5rem;
            margin: 20px 0;
        }
        
        .killer-confirm {
            font-size: 1.5rem;
            color: #2ecc71;
            margin: 10px 0;
        }
        
        /* 响应式调整 */
        @media (max-width: 768px) {
            h1 {
                font-size: 2.2rem;
            }
            
            .difficulty-options {
                grid-template-columns: 1fr;
            }
            
            .suspect-cell {
                font-size: 2rem;
            }
            
            .modal-content {
                padding: 25px;
            }
            
            .modal-title {
                font-size: 1.8rem;
            }
            
            .tools-container {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        /* 滚动条样式 */
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: rgba(20, 20, 35, 0.5);
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: linear-gradient(45deg, #9b59b6, #6a5acd);
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #6a5acd;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1><i class="fas fa-hat-wizard"></i> 女巫的毒药</h1>
        <p class="subtitle">在嫌疑人中找出真凶，揭开神秘死亡背后的真相！</p>
    </div>
    
    <div id="difficultyScreen" class="difficulty-screen">
        <h2 class="difficulty-title">选择游戏难度</h2>
        <p>难度越高，嫌疑人越多，但每天获得的行动点也越多</p>
        
        <div class="difficulty-options">
            <div class="difficulty-card" data-difficulty="easy">
                <h3>容易模式</h3>
                <p><i class="fas fa-chess-board"></i> 2×2嫌疑人网格</p>
                <p><i class="fas fa-running"></i> 每天1行动点</p>
                <p><i class="fas fa-ban"></i> 无道具</p>
            </div>
            
            <div class="difficulty-card" data-difficulty="medium">
                <h3>一般模式</h3>
                <p><i class="fas fa-chess-board"></i> 3×3嫌疑人网格</p>
                <p><i class="fas fa-running"></i> 每天2行动点</p>
                <p><i class="fas fa-magic"></i> 2个随机道具</p>
            </div>
            
            <div class="difficulty-card" data-difficulty="hard">
                <h3>困难模式</h3>
                <p><i class="fas fa-chess-board"></i> 4×4嫌疑人网格</p>
                <p><i class="fas fa-running"></i> 每天3行动点</p>
                <p><i class="fas fa-magic"></i> 3个道具</p>
            </div>
            
            <div class="difficulty-card" data-difficulty="expert">
                <h3>极难模式</h3>
                <p><i class="fas fa-chess-board"></i> 5×5嫌疑人网格</p>
                <p><i class="fas fa-running"></i> 每天4行动点</p>
                <p><i class="fas fa-magic"></i> 3个道具</p>
            </div>
        </div>
    </div>
    
    <div id="gameContainer" class="game-container" style="display: none;">
        <div class="main-content">
            <!-- 案件背景 -->
            <div class="story-section">
                <h3 class="story-title"><i class="fas fa-book-open"></i> 案件背景</h3>
                <p class="story-content" id="storyContent"></p>
            </div>
            
            <!-- 游戏信息与道具箱 -->
            <div class="info-tools-container">
                <!-- 游戏信息 -->
                <div class="game-info">
                    <h3 class="section-title"><i class="fas fa-info-circle"></i> 游戏信息</h3>
                    <div class="info-item">
                        <span class="info-label">剩余天数：</span>
                        <span class="info-value days-remaining" id="daysRemaining">3天</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">今日行动点：</span>
                        <span class="info-value actions-remaining" id="actionsRemaining">0</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">已排除：</span>
                        <span class="info-value" id="eliminatedCount">0</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">剩余嫌疑人：</span>
                        <span class="info-value" id="remainingCount">0</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">当前天数：</span>
                        <span class="info-value" id="currentDay">第1天</span>
                    </div>
                </div>
                
                <!-- 道具箱 -->
                <div class="tools-section">
                    <h3 class="section-title"><i class="fas fa-toolbox"></i> 道具箱</h3>
                    <div class="tools-container" id="toolsContainer">
                        <!-- 道具卡片由JS动态生成 -->
                    </div>
                </div>
            </div>
            
            <!-- 推理日志 -->
            <div class="log-section">
                <h3 class="log-title"><i class="fas fa-scroll"></i> 推理日志</h3>
                <div class="log-content" id="logContent"></div>
            </div>
            
            <!-- 嫌疑人网格 -->
            <div class="suspects-section">
                <h3 class="suspects-title"><i class="fas fa-search"></i> 嫌疑人</h3>
                <div class="grid-container" id="suspectGrid"></div>
            </div>
            
            <!-- 按钮区域 -->
            <div class="buttons-container">
                <button class="btn" id="nextDayBtn">
                    <i class="fas fa-moon"></i> <span id="nextDayText">结束第1天调查</span>
                </button>
                
                <button class="btn btn-restart" id="restartBtn">
                    <i class="fas fa-redo"></i> 重新开始游戏
                </button>
            </div>
        </div>
    </div>
    
    <div class="modal" id="gameOverModal">
        <div class="modal-content">
            <h2 class="modal-title" id="modalTitle">案件侦破！</h2>
            <h3 class="modal-subtitle" id="modalSubtitle">你成功抓住了真凶！</h3>
            
            <div class="modal-story">
                <h4>真相揭秘：</h4>
                <p id="truthReveal"></p>
            </div>
            
            <div class="modal-killer" id="killerEmoji"></div>
            <div class="killer-confirm" id="killerConfirm"></div>
            
            <button class="btn" id="playAgainBtn" style="margin-top: 20px; width: 100%;">
                <i class="fas fa-play"></i> 再玩一次
            </button>
        </div>
    </div>

    <script>
        // 完整的25个emoji数据库
        const emojis = [
            "🧚‍♀️", "🧜🏼‍♀️", "🧞‍♂️", "🧟‍♂️", "🧛‍♂️",
            "👩‍💻", "🧝‍♀️", "🧙‍♂️", "🧑‍🎄", "🦹🏼‍♂️",
            "🦸🏼‍♂️", "🥷", "🤴🏻", "👸🏻", "👩🏽‍🎨",
            "🧑🏾‍✈️", "👩🏼‍🔬", "🧑🏻‍🔧", "👩🏻‍🌾", "🧕🏾",
            "🕺🏻", "💃🏻", "👩🏽‍🚒", "🧑🏽‍🎤", "👩🏽‍🍳"
        ];
        
        // 每个emoji对应的名称
        const suspectNames = {
            "🧚‍♀️": "仙子",
            "🧜🏼‍♀️": "美人鱼",
            "🧞‍♂️": "灯神",
            "🧟‍♂️": "僵尸",
            "🧛‍♂️": "吸血鬼",
            "👩‍💻": "程序员",
            "🧝‍♀️": "精灵",
            "🧙‍♂️": "巫师",
            "🧑‍🎄": "圣诞老人",
            "🦹🏼‍♂️": "超级反派",
            "🦸🏼‍♂️": "超级英雄",
            "🥷": "忍者",
            "🤴🏻": "王子",
            "👸🏻": "公主",
            "👩🏽‍🎨": "艺术家",
            "🧑🏾‍✈️": "飞行员",
            "👩🏼‍🔬": "科学家",
            "🧑🏻‍🔧": "机械师",
            "👩🏻‍🌾": "农民",
            "🧕🏾": "戴头巾的女性",
            "🕺🏻": "跳舞的男人",
            "💃🏻": "跳舞的女人",
            "👩🏽‍🚒": "消防员",
            "🧑🏽‍🎤": "歌手",
            "👩🏽‍🍳": "厨师"
        };
        
        // 每个emoji对应的完整故事
        const stories = {
            "🧚‍♀️": {
                background: "在月光森林的深处，守护者艾琳被发现倒在一朵巨大的魔法花旁，她的身体被奇怪的发光粉末覆盖。现场没有明显的打斗痕迹，只有散落的花瓣和微弱的光点。",
                truth: "凶手是仙子🧚‍♀️。她嫉妒守护者艾琳与森林的亲密联系，在魔法花粉中混入了致命毒素，导致艾琳在照料花朵时中毒身亡。",
                alibis: {}
            },
            "🧜🏼‍♀️": {
                background: "在珊瑚宫殿的宝库中，海王的三叉戟被盗，守卫特里同被发现死在海藻丛中。他的脖子上有奇怪的咬痕，周围散落着珍珠和贝壳。",
                truth: "凶手是美人鱼🧜🏼‍♀️。她为了获得自由，用海蛇毒牙制成的匕首刺杀了守卫，并偷走了三叉戟，计划推翻海王的统治。",
                alibis: {}
            },
            "🧞‍♂️": {
                background: "在沙漠集市的神灯展览会上，一盏古老的铜灯被打破，灯神卡里姆被发现死亡。他的身体呈现出奇特的半透明状态，周围散落着玻璃碎片。",
                truth: "凶手是灯神🧞‍♂️。他因被另一个灯神诅咒而自爆身亡，但现场痕迹表明有人故意破坏了封印，导致诅咒提前爆发。",
                alibis: {}
            },
            "🧟‍♂️": {
                background: "在废弃墓地的守墓人小屋，老守墓人被发现死亡，尸体上有明显的撕咬痕迹。奇怪的是，墓地中的几个坟墓被挖开，但没有任何物品丢失。",
                truth: "凶手是僵尸🧟‍♂️。他因长期饥饿失去理智，袭击了唯一能给他提供食物的守墓人。撕咬痕迹和墓地被挖都是他寻找食物的证据。",
                alibis: {}
            },
            "🧛‍♂️": {
                background: "在古堡的宴会厅，贵族少女艾米莉亚被发现死在钢琴旁，脖子上有两个细小的孔洞。大厅的窗户敞开，地上有少量泥土和水渍。",
                truth: "凶手是吸血鬼🧛‍♂️。他为了报复艾米莉亚家族几个世纪前的背叛，在满月之夜潜入古堡，吸干了她的血液。",
                alibis: {}
            },
            "👩‍💻": {
                background: "在科技公司的服务器机房，首席程序员马克被发现死在控制台前。他的电脑屏幕上显示着奇怪的代码，机房温度异常升高。",
                truth: "凶手是程序员👩‍💻。她因被马克窃取了人工智能算法的专利，在服务器中植入了过载程序，导致机房温度骤升引发心脏骤停。",
                alibis: {}
            },
            "🧝‍♀️": {
                background: "在古树森林的祭坛，大祭司奥利安被发现死亡，身体被荆棘缠绕。祭坛上的圣杯被打翻，周围树木呈现出不自然的枯萎状态。",
                truth: "凶手是精灵🧝‍♀️。她反对奥利安与人类的合作政策，用被污染的圣水毒死了他，导致森林生命力失衡。",
                alibis: {}
            },
            "🧙‍♂️": {
                background: "在魔法学院的图书馆，院长阿尔布斯被发现死在一本打开的禁书旁。他的身体被石化了一半，眼镜碎裂在地板上。",
                truth: "凶手是巫师🧙‍♂️。他为了获取禁书中的黑魔法知识，在院长发现时使用了石化咒语，但因咒语反噬导致院长部分石化死亡。",
                alibis: {}
            },
            "🧑‍🎄": {
                background: "在玩具工厂的礼物工坊，老板尼克被发现死在装满礼物的雪橇旁。他的胡子上沾满了奇怪的粘液，周围散落着破损的玩具。",
                truth: "凶手是圣诞老人🧑‍🎄。他因尼克计划用机器人取代圣诞老人，在礼物中设置了炸弹，却意外提前引爆。",
                alibis: {}
            },
            "🦹🏼‍♂️": {
                background: "在城市银行的保险库，保安队长被发现死在打开的金库前。奇怪的是，大量现金仍在原处，只有一件特定的艺术品被盗。",
                truth: "凶手是超级反派🦹🏼‍♂️。他为了获取藏在金库中的外星能源晶体，用次声波武器杀死了保安队长。",
                alibis: {}
            },
            "🦸🏼‍♂️": {
                background: "在太空站的反应堆室，宇航员李博士被发现死亡。他的宇航服被撕裂，手中紧握着一块发光的陨石碎片。",
                truth: "凶手是超级英雄🦸🏼‍♂️。他因被陨石辐射影响而失控，意外释放能量冲击导致李博士死亡。",
                alibis: {}
            },
            "🥷": {
                background: "在博物馆的日本刀展区，馆长山本被发现死在展示柜旁。现场没有强行进入的痕迹，但一把珍贵的武士刀失踪了。",
                truth: "凶手是忍者🥷。他奉组织命令取回家族传世宝刀，用窒息钢丝暗杀了发现他的馆长。",
                alibis: {}
            },
            "🤴🏻": {
                background: "在皇家花园的茶会，公爵夫人被发现死在玫瑰丛中。她的茶杯中检测出剧毒，王冠上的宝石失踪了。",
                truth: "凶手是王子🤴🏻。他为了阻止公爵夫人揭露他的继承权丑闻，在她的茶中加入了马钱子碱。",
                alibis: {}
            },
            "👸🏻": {
                background: "在城堡的舞厅，舞会主持人被发现死在阳台上。她的礼服被撕破，手中紧握着一颗珍珠纽扣。",
                truth: "凶手是公主👸🏻。她因嫉妒主持人与王子的亲密关系，在争吵中将对方推下阳台。",
                alibis: {}
            },
            "👩🏽‍🎨": {
                background: "在艺术画廊的新品发布会，评论家查尔斯被发现死在未完成的画作前。他的脸上沾满了颜料，画作被严重破坏。",
                truth: "凶手是艺术家👩🏽‍🎨。她因查尔斯给她的作品差评而愤怒，用调色刀刺死了他。",
                alibis: {}
            },
            "🧑🏾‍✈️": {
                background: "在飞机驾驶舱，副机师被发现死在座位上。飞行记录仪显示飞机曾短暂失控，仪表盘上有奇怪的刮痕。",
                truth: "凶手是飞行员🧑🏾‍✈️。他因副机师发现他走私珠宝，在飞行中制造缺氧环境导致对方昏迷死亡。",
                alibis: {}
            },
            "👩🏼‍🔬": {
                background: "在实验室的无菌室，研究员大卫被发现死亡。他的防护服被刺破，培养皿中的致命病毒样本失踪。",
                truth: "凶手是科学家👩🏼‍🔬。她为了获取大卫的研究成果，在防护服上做了手脚，使他暴露在致命病毒中。",
                alibis: {}
            },
            "🧑🏻‍🔧": {
                background: "在汽车修理厂，老板托尼被发现死在升降机下。他的工具散落一地，刹车系统被篡改过。",
                truth: "凶手是机械师🧑🏻‍🔧。他因托尼克扣工资，故意破坏了升降机的液压系统导致事故。",
                alibis: {}
            },
            "👩🏻‍🌾": {
                background: "在有机农场的谷仓，农产品检查员被发现死在麦堆中。他的嘴里塞满了有机苹果，检测仪显示异常农药残留。",
                truth: "凶手是农民👩🏻‍🌾。她因检查员要曝光她使用违禁农药，用毒苹果杀人灭口。",
                alibis: {}
            },
            "🧕🏾": {
                background: "在清真寺的图书馆，伊玛目被发现死在祈祷毯上。他的经书被撕毁，现场有奇怪的香水气味。",
                truth: "凶手是戴头巾的女性🧕🏾。她因伊玛目反对女性教育，在香炉中混入致幻剂导致其心脏病发。",
                alibis: {}
            },
            "🕺🏻": {
                background: "在夜总会的舞池，明星DJ被发现死在音响设备旁。他的耳机线缠绕在脖子上，控制台被破坏。",
                truth: "凶手是跳舞的男人🕺🏻。他因DJ偷了他的混音作品，在争吵中用耳机线意外勒死了对方。",
                alibis: {}
            },
            "💃🏻": {
                background: "在芭蕾舞剧院的化妆间，首席舞者被发现死在镜子前。她的舞鞋被割破，地板上洒满了滑石粉。",
                truth: "凶手是跳舞的女人💃🏻。她为了取代首席位置，在舞鞋中放置了毒针。",
                alibis: {}
            },
            "👩🏽‍🚒": {
                background: "在火灾现场的废墟，消防队长被发现死在逃生通道。他的氧气罐阀门被关闭，头盔上有重物击打痕迹。",
                truth: "凶手是消防员👩🏽‍🚒。她因队长掩盖她过去的失误导致队友死亡，在混乱中实施了报复。",
                alibis: {}
            },
            "🧑🏽‍🎤": {
                background: "在演唱会的后台，音乐制作人被发现死在休息室。他的耳朵流血，音响设备被调到最大音量。",
                truth: "凶手是歌手🧑🏽‍🎤。他因制作人泄露他的吸毒丑闻，用高频声波武器制造了杀人现场。",
                alibis: {}
            },
            "👩🏽‍🍳": {
                background: "在米其林餐厅的厨房，美食评论家被发现死在冷藏库。他的嘴里塞满了鹅肝酱，体温计显示零下温度。",
                truth: "凶手是厨师👩🏽‍🍳。她因评论家给了餐厅差评，将他锁在冷藏库并制造了意外假象。",
                alibis: {}
            }
        };
        
        // 为每个嫌疑人创建质疑理由
        emojis.forEach(emoji => {
            if (!stories[emoji].alibis) stories[emoji].alibis = {};
            
            emojis.filter(e => e !== emoji).forEach(otherEmoji => {
                const reasons = [
                    `有监控录像显示${suspectNames[otherEmoji]}案发时在另一个城市`,
                    `${suspectNames[otherEmoji]}有完整的不在场证明，多人可以作证`,
                    `法医报告显示死亡时间与${suspectNames[otherEmoji]}的行程完全不符`,
                    `${suspectNames[otherEmoji]}的DNA与现场遗留物不匹配`,
                    `没有证据显示${suspectNames[otherEmoji]}有作案动机`,
                    `${suspectNames[otherEmoji]}的指纹与凶器上的不匹配`,
                    `目击者证实${suspectNames[otherEmoji]}在案发时在公开场合出现`,
                    `技术分析排除了${suspectNames[otherEmoji]}的作案可能性`,
                    `通信记录显示${suspectNames[otherEmoji]}当时正在视频通话`,
                    `法医证据表明凶手特征与${suspectNames[otherEmoji]}不符`
                ];
                
                stories[emoji].alibis[otherEmoji] = reasons;
            });
        });

        // 游戏数据
        const gameData = {
            emojis: emojis,
            stories: stories,
            tools: [
                { id: 1, name: "线索分析", icon: "fas fa-filter", desc: "随机排除2-4名无辜嫌疑人" },
                { id: 2, name: "区域排除", icon: "fas fa-times-circle", desc: "排除一整行或一整列嫌疑人" },
                { id: 3, name: "无辜排除", icon: "fas fa-user-slash", desc: "随机排除3-5名无辜嫌疑人" }
            ]
        };

        // 游戏状态
        let gameState = {
            difficulty: null,
            killer: null,
            suspects: [],
            eliminated: [],
            currentDay: 1,
            actionsLeft: 0,
            tools: [], // 当前可用的道具
            gameOver: false,
            story: "",
            truth: "",
            alibis: {},
            toolUsedToday: false // 标记当天是否已使用道具
        };

        // DOM 元素
        const difficultyScreen = document.getElementById('difficultyScreen');
        const gameContainer = document.getElementById('gameContainer');
        const suspectGrid = document.getElementById('suspectGrid');
        const storyContent = document.getElementById('storyContent');
        const logContent = document.getElementById('logContent');
        const daysRemaining = document.getElementById('daysRemaining');
        const actionsRemaining = document.getElementById('actionsRemaining');
        const eliminatedCount = document.getElementById('eliminatedCount');
        const remainingCount = document.getElementById('remainingCount');
        const currentDay = document.getElementById('currentDay');
        const nextDayText = document.getElementById('nextDayText');
        const toolsContainer = document.getElementById('toolsContainer');
        const gameOverModal = document.getElementById('gameOverModal');
        const modalTitle = document.getElementById('modalTitle');
        const modalSubtitle = document.getElementById('modalSubtitle');
        const truthReveal = document.getElementById('truthReveal');
        const killerEmoji = document.getElementById('killerEmoji');
        const killerConfirm = document.getElementById('killerConfirm');

        // 初始化游戏
        function initGame(difficulty) {
            gameState.difficulty = difficulty;
            
            // 根据难度设置网格大小
            let gridSize;
            switch(difficulty) {
                case 'easy': gridSize = 4; break;
                case 'medium': gridSize = 9; break;
                case 'hard': gridSize = 16; break;
                case 'expert': gridSize = 25; break;
            }
            
            // 随机选择嫌疑人
            const shuffledEmojis = [...gameData.emojis].sort(() => Math.random() - 0.5);
            gameState.suspects = shuffledEmojis.slice(0, gridSize);
            
            // 随机选择凶手
            gameState.killer = gameState.suspects[Math.floor(Math.random() * gameState.suspects.length)];
            
            // 设置故事背景和真相
            gameState.story = gameData.stories[gameState.killer].background;
            gameState.truth = gameData.stories[gameState.killer].truth;
            gameState.alibis = gameData.stories[gameState.killer].alibis;
            
            // 重置游戏状态
            gameState.eliminated = [];
            gameState.currentDay = 1;
            gameState.tools = [];
            gameState.gameOver = false;
            gameState.toolUsedToday = false;
            
            // 根据难度设置道具
            setupToolsForDifficulty(difficulty);
            
            // 初始化UI
            renderGame();
            
            // 显示游戏界面
            difficultyScreen.style.display = 'none';
            gameContainer.style.display = 'flex';
            
            // 开始第一天
            startNewDay();
        }

        // 根据难度设置道具
        function setupToolsForDifficulty(difficulty) {
            gameState.tools = [];
            
            // 复制道具数组
            let availableTools = [...gameData.tools];
            
            switch(difficulty) {
                case 'easy':
                    // 容易模式：无道具
                    break;
                    
                case 'medium':
                    // 一般模式：随机提供2个道具
                    // 随机打乱道具数组
                    availableTools.sort(() => Math.random() - 0.5);
                    // 取前2个
                    gameState.tools = availableTools.slice(0, 2).map(tool => ({
                        ...tool, 
                        status: 'active',
                        used: false
                    }));
                    break;
                    
                case 'hard':
                case 'expert':
                    // 困难和极难模式：提供全部3个道具
                    gameState.tools = [...gameData.tools].map(tool => ({
                        ...tool, 
                        status: 'active',
                        used: false
                    }));
                    break;
            }
        }

        // 开始新的一天
        function startNewDay() {
            // 设置行动点（根据难度）
            switch(gameState.difficulty) {
                case 'easy': gameState.actionsLeft = 1; break;
                case 'medium': gameState.actionsLeft = 2; break;
                case 'hard': gameState.actionsLeft = 3; break;
                case 'expert': gameState.actionsLeft = 4; break;
            }
            
            // 重置当天道具使用标记
            gameState.toolUsedToday = false;
            
            // 更新道具状态
            gameState.tools.forEach(tool => {
                if (tool.status === 'frozen') {
                    tool.status = 'active';
                }
            });
            
            // 更新UI
            updateGameInfo();
            renderTools();
            renderSuspectGrid();
            
            // 添加日志
            addLogEntry(`第 ${gameState.currentDay} 天开始，你有 ${gameState.actionsLeft} 个行动点`);
            
            // 检查是否最后一天
            const daysLeft = 4 - gameState.currentDay;
            daysRemaining.textContent = `${daysLeft}天`;
            daysRemaining.className = daysLeft === 1 ? 'info-value days-remaining danger' : 'info-value days-remaining';
            
            // 更新结束按钮文本
            nextDayText.textContent = `结束第${gameState.currentDay}天调查`;
            
            // 更新当前天数显示
            currentDay.textContent = `第${gameState.currentDay}天`;
        }

        // 渲染道具 - 重点优化部分
        function renderTools() {
            toolsContainer.innerHTML = '';
            
            if (gameState.tools.length === 0) {
                toolsContainer.innerHTML = '<p style="text-align: center; color: #a0a0c0;">当前没有可用道具</p>';
                return;
            }
            
            gameState.tools.forEach((tool, index) => {
                const toolCard = document.createElement('div');
                let cardClass = 'tool-card';
                
                if (tool.used) {
                    cardClass += ' used';
                } else if (tool.status === 'frozen') {
                    cardClass += ' frozen';
                }
                
                toolCard.className = cardClass;
                toolCard.dataset.index = index;
                toolCard.title = tool.desc;
                
                toolCard.innerHTML = `
                    <div class="tool-icon"><i class="${tool.icon}"></i></div>
                    <div class="tool-name">${tool.name}</div>
                `;
                
                if (tool.status === 'active' && !tool.used) {
                    toolCard.addEventListener('click', () => useTool(index));
                }
                
                toolsContainer.appendChild(toolCard);
            });
        }

        // 渲染游戏
        function renderGame() {
            // 设置故事背景
            storyContent.textContent = gameState.story;
            
            // 渲染道具
            renderTools();
            
            // 渲染嫌疑人网格
            renderSuspectGrid();
            
            // 清空日志
            logContent.innerHTML = '';
            addLogEntry("案件调查开始。找出凶手，你有3天时间！");
            
            // 更新游戏信息
            updateGameInfo();
        }

        // 渲染嫌疑人网格
        function renderSuspectGrid() {
            suspectGrid.innerHTML = '';
            
            // 设置网格类
            let gridClass;
            switch(gameState.difficulty) {
                case 'easy': gridClass = 'grid-2x2'; break;
                case 'medium': gridClass = 'grid-3x3'; break;
                case 'hard': gridClass = 'grid-4x4'; break;
                case 'expert': gridClass = 'grid-5x5'; break;
            }
            suspectGrid.className = `grid-container ${gridClass}`;
            
            // 创建网格元素
            gameState.suspects.forEach((suspect, index) => {
                const cell = document.createElement('div');
                cell.className = 'suspect-cell';
                if (gameState.eliminated.includes(index)) {
                    cell.classList.add('eliminated');
                }
                cell.textContent = suspect;
                cell.dataset.index = index;
                
                cell.addEventListener('click', () => investigateSuspect(index));
                suspectGrid.appendChild(cell);
            });
        }

        // 调查嫌疑人
        function investigateSuspect(index) {
            // 检查游戏状态
            if (gameState.gameOver || gameState.actionsLeft <= 0) return;
            
            // 检查是否已被排除
            if (gameState.eliminated.includes(index)) {
                addLogEntry("这个嫌疑人已经被排除过了！", "eliminated");
                return;
            }
            
            // 消耗行动点
            gameState.actionsLeft--;
            
            const suspect = gameState.suspects[index];
            
            // 检查是否是凶手
            if (suspect === gameState.killer) {
                // 游戏胜利
                endGame(true, index);
                return;
            }
            
            // 排除嫌疑人
            gameState.eliminated.push(index);
            
            // 获取该嫌疑人的质疑理由
            const alibis = gameState.alibis[suspect];
            const randomAlibi = alibis[Math.floor(Math.random() * alibis.length)];
            
            addLogEntry(
                `你调查了嫌疑人 ${suspect}：${randomAlibi}，排除嫌疑！`,
                "eliminated"
            );
            
            // 更新UI
            renderSuspectGrid();
            updateGameInfo();
            
            // 检查是否所有嫌疑人都被排除
            if (gameState.eliminated.length === gameState.suspects.length - 1) {
                // 找出凶手
                const killerIndex = gameState.suspects.findIndex((s, i) => s === gameState.killer && !gameState.eliminated.includes(i));
                endGame(true, killerIndex);
            }
            
            // 检查行动点是否用完
            if (gameState.actionsLeft <= 0) {
                addLogEntry("今天的行动点已用完。明天继续调查！");
            }
        }

        // 使用道具
        function useTool(toolIndex) {
            // 检查游戏状态
            if (gameState.gameOver || gameState.actionsLeft <= 0) return;
            
            // 检查当天是否已使用过道具
            if (gameState.toolUsedToday) {
                addLogEntry("今天已经使用过道具了！");
                return;
            }
            
            // 获取道具
            const tool = gameState.tools[toolIndex];
            
            // 检查道具是否可用
            if (tool.used || tool.status !== 'active') {
                addLogEntry("这个道具当前不可用！");
                return;
            }
            
            // 消耗行动点
            gameState.actionsLeft--;
            
            // 标记道具为已使用
            tool.used = true;
            gameState.toolUsedToday = true;
            
            // 冻结其他未使用的道具
            gameState.tools.forEach((t, idx) => {
                if (idx !== toolIndex && !t.used) {
                    t.status = 'frozen';
                }
            });
            
            // 根据道具类型执行效果
            let eliminated = [];
            let toolName = tool.name;
            
            switch(tool.id) {
                case 1: // 线索分析（随机排除2-4个）
                    const count = Math.min(4, gameState.suspects.length - gameState.eliminated.length - 1);
                    const toEliminate = Math.max(2, Math.floor(count * 0.6));
                    
                    for (let i = 0; i < toEliminate; i++) {
                        let randomIndex;
                        do {
                            randomIndex = Math.floor(Math.random() * gameState.suspects.length);
                        } while (
                            gameState.eliminated.includes(randomIndex) || 
                            gameState.suspects[randomIndex] === gameState.killer ||
                            eliminated.includes(randomIndex)
                        );
                        eliminated.push(randomIndex);
                    }
                    addLogEntry(`你使用了【${toolName}】，排除了 ${eliminated.length} 名无辜嫌疑人`, "tool-used");
                    break;
                    
                case 2: // 区域排除（整行或整列）
                    const gridSize = Math.sqrt(gameState.suspects.length);
                    const isRow = Math.random() > 0.5;
                    const lineIndex = Math.floor(Math.random() * gridSize);
                    
                    for (let i = 0; i < gridSize; i++) {
                        const index = isRow ? (lineIndex * gridSize + i) : (i * gridSize + lineIndex);
                        if (!gameState.eliminated.includes(index)) {
                            eliminated.push(index);
                        }
                    }
                    addLogEntry(`你使用了【${toolName}】，排除了${isRow ? '一行' : '一列'}嫌疑人`, "tool-used");
                    break;
                    
                case 3: // 无辜排除（随机排除3-5个）
                    const count2 = Math.min(5, gameState.suspects.length - gameState.eliminated.length - 1);
                    const toEliminate2 = Math.max(3, Math.floor(count2 * 0.7));
                    
                    for (let i = 0; i < toEliminate2; i++) {
                        let randomIndex;
                        do {
                            randomIndex = Math.floor(Math.random() * gameState.suspects.length);
                        } while (
                            gameState.eliminated.includes(randomIndex) || 
                            gameState.suspects[randomIndex] === gameState.killer ||
                            eliminated.includes(randomIndex)
                        );
                        eliminated.push(randomIndex);
                    }
                    addLogEntry(`你使用了【${toolName}】，排除了 ${eliminated.length} 名无辜嫌疑人`, "tool-used");
                    break;
            }
            
            // 排除嫌疑人（确保不排除凶手）
            eliminated = eliminated.filter(index => gameState.suspects[index] !== gameState.killer);
            gameState.eliminated = [...gameState.eliminated, ...eliminated];
            
            // 更新UI
            renderTools();
            renderSuspectGrid();
            updateGameInfo();
            
            // 检查是否所有嫌疑人都被排除
            if (gameState.eliminated.length === gameState.suspects.length - 1) {
                // 找出凶手
                const killerIndex = gameState.suspects.findIndex((s, i) => s === gameState.killer && !gameState.eliminated.includes(i));
                endGame(true, killerIndex);
            }
        }

        // 结束一天
        function endDay() {
            gameState.currentDay++;
            
            // 检查是否超过3天
            if (gameState.currentDay > 3) {
                endGame(false);
                return;
            }
            
            startNewDay();
        }

        // 结束游戏
        function endGame(isWin, killerIndex = null) {
            gameState.gameOver = true;
            
            if (isWin) {
                modalTitle.textContent = "案件侦破！";
                modalSubtitle.textContent = "你成功抓住了真凶！";
                killerEmoji.textContent = gameState.killer;
                killerConfirm.textContent = `✅ 凶手是 ${gameState.killer}`;
            } else {
                modalTitle.textContent = "游戏结束";
                modalSubtitle.textContent = "凶手逃脱了...";
                killerEmoji.textContent = gameState.killer;
                killerConfirm.textContent = `真凶是 ${gameState.killer}`;
            }
            
            truthReveal.textContent = gameState.truth;
            gameOverModal.classList.add('active');
        }

        // 添加日志条目
        function addLogEntry(message, type = "") {
            const now = new Date();
            const timeString = `${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}`;
            
            const logEntry = document.createElement('div');
            logEntry.className = `log-entry ${type}`;
            logEntry.innerHTML = `
                <div class="log-time">${timeString}</div>
                <div>${message}</div>
            `;
            
            logContent.appendChild(logEntry);
            logContent.scrollTop = logContent.scrollHeight;
        }

        // 更新游戏信息
        function updateGameInfo() {
            daysRemaining.textContent = `${4 - gameState.currentDay}天`;
            daysRemaining.className = (4 - gameState.currentDay) === 1 ? 
                'info-value days-remaining danger' : 'info-value days-remaining';
                
            actionsRemaining.textContent = gameState.actionsLeft;
            eliminatedCount.textContent = gameState.eliminated.length;
            remainingCount.textContent = gameState.suspects.length - gameState.eliminated.length;
        }

        // 事件监听器
        document.querySelectorAll('.difficulty-card').forEach(card => {
            card.addEventListener('click', () => {
                const difficulty = card.dataset.difficulty;
                initGame(difficulty);
            });
        });

        document.getElementById('nextDayBtn').addEventListener('click', endDay);
        document.getElementById('restartBtn').addEventListener('click', () => {
            gameContainer.style.display = 'none';
            difficultyScreen.style.display = 'block';
        });

        document.getElementById('playAgainBtn').addEventListener('click', () => {
            gameOverModal.classList.remove('active');
            gameContainer.style.display = 'none';
            difficultyScreen.style.display = 'block';
        });
    </script>
</body>
</html>
